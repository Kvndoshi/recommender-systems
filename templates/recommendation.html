<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>book-recommender-systems</title>
    <!-- CSS only -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

</head>
<style>
    .text-white{
    color:white
    }
</style>
<body style="background-color:black">
    <nav class="navbar" style="background-color:turquoise">
        <p class="navbar-brand" style="font-size:40px">MY BOOK RECOMMENDER</p><br><br>

        <ul class="nav navbar-nav" style="font-size:20px">
        <li><a href="/">HOME</a></li>
        <li><a href="/recommend">RECOMMEND</a></li>
        <li><a href="/contact">CONTACT</a></li>
            </ul>

    </nav>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1 class="text-white">RECOMMEND BOOKS</h1>
                <form action="/recommend_books" method="post" autocomplete="off">
                    <input id="user_input" name="user_input" type="text" class="form-control" placeholder="Type a book title...">
                    <div id="suggestions" class="list-group" style="position:relative; z-index:1000;"></div>
                    <br>
                    <input type="submit" class="btn btm-lg btn-warning">
                </form>
            </div>
            {% if data %}
                <div class="col-md-12" style="margin-top:20px">
                    <h3 class="text-white">Top 4 books recommended for {{ query_title }}</h3>
                </div>
                {% for i in data %}
             <div class="col-md-3" style="margin-top:50px">
                <div class="card">
                    <div class="card-body">
                        <img class="card-img-top" src={{i[2]}}>
                            <h2 class="text-white">{{i[0]}}</h2>
                            <h4 class="text-white">{{i[1]}}</h4>

                    </div>
                </div>
            </div>

                {% endfor %}

            {% endif %}



        </div>
    </div>

    <script>
    (function() {
        var input = document.getElementById('user_input');
        var box = document.getElementById('suggestions');

        function clearBox() {
            box.innerHTML = '';
            box.style.display = 'none';
        }

        function render(items) {
            if (!items || items.length === 0) {
                clearBox();
                return;
            }
            box.innerHTML = '';
            items.forEach(function(title) {
                var a = document.createElement('a');
                a.href = '#';
                a.className = 'list-group-item';
                a.textContent = title;
                a.onclick = function(e) {
                    e.preventDefault();
                    input.value = title;
                    clearBox();
                };
                box.appendChild(a);
            });
            box.style.display = 'block';
        }

        var debounceTimer = null;
        input.addEventListener('input', function() {
            var q = input.value.trim();
            if (debounceTimer) window.clearTimeout(debounceTimer);
            if (q.length === 0) { clearBox(); return; }
            debounceTimer = window.setTimeout(function() {
                fetch('/suggest_titles?q=' + encodeURIComponent(q))
                    .then(function(r) { return r.json(); })
                    .then(render)
                    .catch(function() { clearBox(); });
            }, 150);
        });

        document.addEventListener('click', function(e) {
            if (!box.contains(e.target) && e.target !== input) {
                clearBox();
            }
        });
    })();
    </script>

</body>
</html>